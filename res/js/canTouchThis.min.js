
function Touch(b){var a=Date.now();this.identifier=b.identifier===undefined?1000:b.identifier;this.target=b.target;this.moved=false;this.startX=b.pageX||b.clientX;this.startY=b.pageY||b.clientY;this.pageX=b.pageX||b.clientX;this.pageY=b.pageY||b.clientY;this.sibling=Touch.getSibling(this);this.distanceFromSibling=this.sibling?Touch.distance(this.pageX,this.pageY,this.sibling.pageX,this.sibling.pageY):undefined;this.swipe=false;this.swipeDirection=0;this.startTime=a;this.holdDuration=0;this.regTime=a;this.regX=b.pageX||b.clientX;this.regY=b.pageY||b.clientY}Touch.UP=1;Touch.RIGHT=2;Touch.DOWN=4;Touch.LEFT=8;Touch._onGoingTouch_=[];Touch._lastTap_={x:0,y:0,t:0};Touch.swipeMinDistance=50;Touch.swipeMaxTime=250;Touch.tapMaxDistance=10;Touch.dblTapMaxDuration=300;Touch.holdTapDuration=750;Touch.distance=function(b,d,a,c){return Math.sqrt(Math.pow((a-b),2)+Math.pow((c-d),2))};Touch.getById=function(c){if(c===undefined){return null}for(var b=0,a=Touch._onGoingTouch_.length;b<a;++b){if(Touch._onGoingTouch_[b].identifier===c){return Touch._onGoingTouch_[b]}}return null};Touch.getSibling=function(b){for(var a=Touch._onGoingTouch_.length-1;a>=0;--a){if(Touch._onGoingTouch_[a].target===b.target){Touch._onGoingTouch_[a].sibling=b;return Touch._onGoingTouch_[a]}}return null};Touch.handleEvent=function(c,d){var e=c.changedTouches;for(var b=0,a=e.length;b<a;++b){d(e[b])}};Touch.add=function(a){var b=new Touch(a);Touch._onGoingTouch_.push(b);return b};Touch.remove=function(a){clearTimeout(a.timer);var b=Touch._onGoingTouch_.indexOf(a);if(b!==-1){Touch._onGoingTouch_.splice(b,1)}return Touch._onGoingTouch_.length};document.addEventListener("touchstart",function(a){Touch.handleEvent(a,function(b){var c=Touch.add(b);c.timer=setTimeout(function(){var e=Touch.getById(b.identifier);if(e&&!e.moved){e.holdDuration=Date.now()-e.startTime;var d=new CustomEvent("holdtap",{bubbles:true,cancelable:true,detail:e});e.target.dispatchEvent(d)}},Touch.holdTapDuration)})},0);document.addEventListener("touchmove",function(b){var a=Date.now();Touch.handleEvent(b,function(c){var e=Touch.getById(c.identifier);if(e){e.pageX=c.pageX;e.pageY=c.pageY;e.holdDuration=a-e.startTime;if(!e.moved&&Touch.distance(e.pageX,e.pageY,e.startX,e.startY)>Touch.tapMaxDistance){e.moved=true;var d=new CustomEvent("grab",{bubbles:true,cancelable:true,detail:e});e.target.dispatchEvent(d)}if(e.moved){if(e.sibling){e.distanceFromSibling=Touch.distance(e.pageX,e.pageY,e.sibling.pageX,e.sibling.pageY);var d=new CustomEvent("pinch",{cancelable:true,detail:e});e.target.dispatchEvent(d)}var d=new CustomEvent("drag",{bubbles:true,cancelable:true,detail:e});e.target.dispatchEvent(d)}if(a-e.regTime<Touch.swipeMaxTime){e.direction=0;if(e.pageX<e.regX-Touch.swipeMinDistance){e.direction=Touch.LEFT}else{if(e.pageX>e.regX+Touch.swipeMinDistance){e.direction=Touch.RIGHT}}if(e.pageY<e.regY-Touch.swipeMinDistance){e.direction+=Touch.UP}else{if(e.pageY>e.regY+Touch.swipeMinDistance){e.direction+=Touch.DOWN}}if(e.direction){var d=new CustomEvent("swipe",{bubbles:true,cancelable:true,detail:e});e.target.dispatchEvent(d)}}else{e.regTime=a;e.regX=e.pageX;e.regY=e.pageY}}})},0);document.addEventListener("touchend",function(b){var a=Date.now();Touch.handleEvent(b,function(c){var e=Touch.getById(c.identifier);if(e){var d;if(!e.moved&&a<e.startTime+Touch.holdTapDuration){if(a<Touch._lastTap_.t+Touch.dblTapMaxDuration&&Touch.distance(e.pageX,e.pageY,Touch._lastTap_.x,Touch._lastTap_.y)<Touch.tapMaxDistance){d=new CustomEvent("dbltap",{bubbles:true,cancelable:true,detail:e});e.target.dispatchEvent(d)}Touch._lastTap_={x:e.pageX,y:e.pageY,t:a}}else{d=new CustomEvent("drop",{bubbles:true,cancelable:true,detail:e});e.target.dispatchEvent(d)}Touch.remove(e)}})},0);document.addEventListener("touchcancel",function(a){Touch.handleEvent(a,function(b){var d=Touch.getById(b.identifier);if(d){var c=new CustomEvent("drop",{bubbles:true,cancelable:true,detail:d});d.target.dispatchEvent(c);Touch.remove(d)}})},0);document.addEventListener("touchleave",function(a){Touch.handleEvent(a,function(b){var c=Touch.getById(b.identifier);if(c){Touch.remove(c)}})},0);