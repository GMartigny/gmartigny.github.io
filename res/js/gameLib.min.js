
var gamelib_loading_progress=0;function loadMedia(h,l){gamelib_loading_progress=0;l=l||function(){};var g=0,j=0,a="",m="",b="",c={};for(var f=0;f<h.length;++f){g=h[f].weight||1;j+=g;a=h[f].src||h[f];b=h[f].name||a;m=h[f].type||defineFormat(a);var d;switch(m){case"image":d=new Image(a);break;case"audio":d=new Audio([a]);break;case"video":d=new Video(a);break;case"script":d=new Script(a);break;case"json":d={};break;case"text":d={};break}d.name=b;d.weight=g;var n=function(){gamelib_loading_progress+=this.weight;l(gamelib_loading_progress/j*100,this.name)};if(m=="audio"){d.addEvent("canplaythrough",n,false)}else{if(m=="text"){get(a,function(){c[d.name]=this.response;n.call(d)})}else{if(m=="json"){get(a,function(){c[d.name]=JSON.parse(this.response);n.call(d)})}else{try{d.addEvent("load",n,false)}catch(k){}}}}c[b]=d}return c}function defineFormat(a){var c=false;if(0<a.lastIndexOf(".")){var b=a.substring(a.lastIndexOf(".")+1);switch(b){case"jpg":case"jpeg":case"png":case"gif":case"tif":case"bmp":c="image";break;case"mp3":case"ogg":case"m4a":case"wma":case"raw":case"wav":c="audio";break;case"mp4":case"avi":case"wmv":case"mov":case"flv":case"mkv":case"mpg":case"ogv":case"webm":c="video";break;case"js":c="script";break;case"json":c="json";break;default:c="text"}}return c}function prepareCanvas(c,e,a){var d=getById(c).getElementsByTagName("canvas"),b=d.length,g={};while(b--){if(e&&a){d[b].width=e;d[b].height=a}var f={can:d[b],ctx:d[b].getContext("2d")};g[f.can.id]=f}return g}HTMLElement.prototype.addEvent=HTMLElement.prototype.addEventListener;window.addEvent=window.addEventListener;window.WebSocket=window.WebSocket||window.MozWebSocket;window.raf=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,16)};navigator.gUM=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;function Image(a){a=a||"";var b=document.createElement("img");b.src=a;return b}HTMLImageElement.prototype.getData=function(){var b=document.createElement("canvas"),a=b.getContext("2d");if(this.width&&this.height){b.width=this.width;b.height=this.height;a.drawImage(this,0,0);var c=a.getImageData(0,0,b.width,b.height);return c}else{return false}};var Video=Video||function(a){var b=document.createElement("video");b.preload="auto";b.src=a;return b};function Audio(c){var d=document.createElement("Audio");d.preload="auto";if(c instanceof Array){for(var a=0;a<c.length;++a){var b=document.createElement("source");b.src=c[a];d.appendChild(b)}}return d}function Script(a){var b=document.createElement("script");b.src=a;document.head.appendChild(b);return b}function Pixel(f,e,c,d){this.r=f;this.g=e;this.b=c;this.a=d}Pixel.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b&&this.a===a.a};Pixel.prototype.getHexa=function(){return"#"+hexa(this.r)+hexa(this.g)+hexa(this.b)};Pixel.prototype.isOpac=function(){return(this.a==255)};function hexa(b){var a=b.toString(16);return(a.length<2)?"0"+a:a}ImageData.prototype.get=function(a,c){if(a<0||this.width<=a||c<0||this.height<=c){return false}else{var b=4*(a+c*this.width);return new Pixel(this.data[b],this.data[++b],this.data[++b],this.data[++b])}};ImageData.prototype.put=function(a,d,c){if(a<0||this.width<=a||d<0||this.height<=d){return false}else{var b=4*(a+d*this.width);this.data[b++]=c.r;this.data[b++]=c.g;this.data[b++]=c.b;this.data[b]=c.a;return true}};CanvasRenderingContext2D.prototype.clear=function(){this.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderingContext2D.prototype.makePath=function(a,c,b){this.beginPath();a.call(this);if(b){this.stroke()}if(c){this.fill()}else{this.closePath()}};function getById(a){return document.getElementById(a)}function getByClass(g,f){f=f||document;if(!f.getElementsByClassName){var e=f.getElementsByTagName("*"),b=0,a=[],d=new RegExp("(^|\\s)"+g+"(\\s|$)");for(b=0;b<e.length;++b){if(e[b].className.match(d)!==null){a.push(e[b])}}return a}else{return f.getElementsByClassName(g)}}function distance(b,a){return sqrt(sq(a.x-b.x)+sq(a.y-b.y))}var sqrt=Math.sqrt,pow=Math.pow,sq=function(a){return pow(a,2)},floor=function(a){if(a>0){return a<<0}else{return a-1<<0}},round=function(a){if(a>0){return a+0.5<<0}else{return a-0.5<<0}},ceil=function(a){if(a>0){return a+1<<0}else{return a<<0}},sin=Math.sin,asin=Math.asin,cos=Math.cos,r=Math.random,PI=Math.PI,PI2=PI*2,SQRT2=sqrt(2)/2;function random(b,a){b=b||0;if(a===undefined){a=b;b=0}return r()*(a-b)+b}function size(c){if(c instanceof Array){return c.length}else{var b=0;for(var a in c){if(c.hasOwnProperty(a)){++b}}return b}}Array.prototype.out=function(b){var a=this.indexOf(b);if(a>=0){this.splice(a,1)}else{throw b+" not find in this array"}};String.prototype.hashCode=function(){var d=0,b,c,a;if(this.length==0){return d}for(b=0,a=this.length;b<a;b++){c=this.charCodeAt(b);d=((d<<5)-d)+c;d|=0}return d};function get(a,c){var b=new XMLHttpRequest();b.open("get",a);b.onload=c;b.send();return b}function log(a){console.log(a)};