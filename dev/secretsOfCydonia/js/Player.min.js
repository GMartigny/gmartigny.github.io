
function Player(a,b){this.layer=a;this.img=b;var c=[];(localStorage.SoC_P&&localStorage.SoC_P.hashCode()==localStorage.SoC_HP)?c=localStorage.SoC_P.split(";"):c=[37,44,Player.DIR_DOWN];this.pos={x:+c[0],y:+c[1]};this.dir=+c[2];this.anim=0;this.display={x:floor((GameController.nbCol-1)/2),y:floor((GameController.nbRow-1)/2)};this.moving=false}Player.DIR_DOWN=0;Player.DIR_LEFT=1;Player.DIR_RIGHT=2;Player.DIR_UP=3;Player.SPEED=0.1;Player.prototype={render:function(){this.layer.clear();var b=round(2/PI*asin(sin(this.anim))+1),a=GameController.cell;this.layer.drawImage(this.img,a*b,a*this.dir,a,a,this.display.x*a,this.display.y*a,a,a)},move:function(b,d){this.moving=false;if(b.keys.length){var e=0,c=0,a;if(b.isPressed(KeyboardManager.DOWN)){this.dir=Player.DIR_DOWN;if(!(a=d.isBlocked(this.pos.x,this.pos.y,this.dir))){c=Player.SPEED;this.moving=true}else{this.pos.y=a.y-1}}else{if(b.isPressed(KeyboardManager.UP)){this.dir=Player.DIR_UP;if(!(a=d.isBlocked(this.pos.x,this.pos.y,this.dir))){c=-Player.SPEED;this.moving=true}else{this.pos.y=a.y}}}if(b.isPressed(KeyboardManager.RIGHT)){this.dir=Player.DIR_RIGHT;if(!(a=d.isBlocked(this.pos.x,this.pos.y,this.dir))){if(this.moving){e=Player.SPEED*SQRT2;c*=SQRT2}else{e=Player.SPEED;this.moving=true}}}else{if(b.isPressed(KeyboardManager.LEFT)){this.dir=Player.DIR_LEFT;if(!(a=d.isBlocked(this.pos.x,this.pos.y,this.dir))){if(this.moving){e=-Player.SPEED*SQRT2;c*=SQRT2}else{e=-Player.SPEED;this.moving=true}}}}if(this.moving){this.pos.x+=e;this.pos.y+=c;this.anim+=Player.SPEED*1.5}else{this.anim=0}var f=this.pos.x+";"+this.pos.y+";"+this.dir;localStorage.SoC_P=f;localStorage.SoC_HP=f.hashCode()}else{this.anim=0}}};