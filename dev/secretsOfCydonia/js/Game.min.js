
function GameController(b){this.map=new MapManager(b.links);var a=prepareCanvas("c",GameController.nbCol*GameController.cell,GameController.nbRow*GameController.cell);this.player=new Player(a.entities.ctx,b.player);this.entities=new EntityManager(a.entities.ctx,b.entities);this.view=new ViewManager(a,b.tiles,this.map.getMap());this.key=new KeyboardManager();this.camera={x:0,y:0};this.centerCameraOn(this.player.pos.x,this.player.pos.y);this.music=new SoundManager();var c=this.view.overlay;this.fps=new FPS(function(d){c.ctx.clear();c.ctx.fillText(d,5,15)},200);this.loop()}GameController.cell=32;GameController.nbRow=21;GameController.nbCol=39;GameController.tickLength=1000/60;GameController.lastTick=0;GameController.prototype={loop:function(b){var a=this;raf(function(c){a.loop.call(a,c)});if(this.view.ready){this.update(floor((b-GameController.lastTick)/GameController.tickLength));this.render();this.fps.update()}else{this.view.checkReady()}},update:function(b){for(var a=0;a<b;++a){this.player.move(this.key,this.view);this.centerCameraOn(this.player.pos.x,this.player.pos.y);this.entities.moveAll(this.player,this.view)}GameController.lastTick+=GameController.tickLength*b},render:function(){this.player.render(this.camera);this.entities.renderAll(this.camera);this.view.renderAll(this.camera)},centerCameraOn:function(a,b){this.camera={x:a-floor((GameController.nbCol-1)/2),y:b-floor((GameController.nbRow-1)/2)}},teleport:function(a){this.map.changeMap(a);this.view.setMap(this.map.getMap())}};