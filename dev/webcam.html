<style>
    #can{
        width : 800px;
        height : 600px;
        border : 1px solid black;
    }
</style>
<p>
    <span id="fps"></span> fps
</p>
<canvas id="can" width="200" height="150"></canvas>
<input id="grey" type="button" value="Grey : Off" onclick="switchFilters(this);"/>

<script>
    var vid = document.createElement("video");
    vid.autoplay = true;
    var can = document.getElementById("can");
    var ctx = can.getContext("2d");
    var fps = document.getElementById("fps");
    var bu = document.getElementById("bu");

    var filters = {};

    function switchFilters(bu){
        filters[bu.id] = !filters[bu.id];
        bu.value = bu.id + " : " + (filters[bu.id] ? "On" : "Off");
    }

    var fpsCount = 0;

    setInterval(function(){
        fps.innerHTML = fpsCount;
        fpsCount = 0;
    }, 1000);

    var onFailSoHard = function(e){
        console.log('Reeeejected!', e);
    };

    navigator.gum = navigator.getUserMedia || navigator.webkitGetUserMedia ||
            navigator.mozGetUserMedia || navigator.msGetUserMedia;
    window.URL = window.URL || window.webkitURL || window.mozURL;
    window.raf = window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.requestAnimationFrame;

    ImageData.prototype.getPixel = function(x, y){
        var p = 4 * (x + y * this.width);
        var d = this.data;
        return new Pixel(d[p++], d[p++], d[p++], d[p]);
    };
    ImageData.prototype.setPixel = function(x, y, P){
        var p = 4 * (x + y * this.width);
        var d = this.data;
        d[p++] = P.r;
        d[p++] = P.g;
        d[p++] = P.b;
        d[p] = P.a;
    };

    var Pixel = function(r, g, b, a){
        this.r = r;
        this.g = g;
        this.b = b;
        this.a = a;

        this.grey = function(){
            var gr = (this.r + this.g + this.b) / 3 << 0;
            this.r = this.g = this.b = gr;
        };
    };

    navigator.gum({
        video: true
    }, function(stream){
        var url = window.webkitURL.createObjectURL(stream);
        vid.src = url;
        draw();
    }, onFailSoHard);

    function draw(){

        ++fpsCount;

        ctx.drawImage(vid, 0, 0, can.width, can.height);

        var imgData = false;
        var p;
        if(filters.grey){
            imgData = ctx.getImageData(0, 0, can.width, can.height);
            for(var i = 0; i < can.width; ++i){
                for(var j = 0; j < can.height; ++j){
                    p = imgData.getPixel(i, j);
                    p.grey();
                    imgData.setPixel(i, j, p);
                }
            }
        }
        raf(draw);

        if(imgData){
            ctx.putImageData(imgData, 0, 0);
        }
    }
</script>