
function Action(a,b){this.locked=true;this.running=false;this.owner=a;this.data=b;this.html=this.toHTML()}Action.prototype={refresh:function(b){if(!this.running){this.locked=false;if(this.data.consume){for(var a in this.data.consume){if(this.data.consume.hasOwnProperty(a)&&(!b[a]||!b[a].has(this.data.consume[a]))){this.locked=true;break}}}if(this.locked){this.html.classList.add("disabled")}else{this.html.classList.remove("disabled")}}},click:function(){var b=this.data.time*Game.time.hourToMs;this.html.classList.add("cooldown");this.html.style.animationDuration=b+"ms";var a=this;setTimeout(function(){a.html.classList.remove("cooldown");if(a.data.give){var e=a.data.give();MessageBus.getInstance().notifyAll(MessageBus.MSG_TYPES.GIVE,e)}if(a.data.unlock){var d=a.data.unlock();MessageBus.getInstance().notifyAll(MessageBus.MSG_TYPES.UNLOCK,d)}if(a.data.lock){var c=a.data.lock();MessageBus.getInstance().notifyAll(MessageBus.MSG_TYPES.LOCK,c)}a.owner.busy=false},b)},toHTML:function(){var b=document.createElement("div"),a=this;b.className="action clickable disabled "+this.data.name.toLowerCase().replace(" ","_");b.innerHTML=this.data.name;if(this.data.desc){b.title=this.data.desc}b.onclick=function(){if(!a.locked&&!a.running&&!a.owner.busy){a.click.call(a)}};return b}};